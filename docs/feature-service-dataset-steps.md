# Гипотеза

Сейчас при билде датасета rolling window сдвигается по 1 минуте. Но так как в текущем feature registry фичи состоят в основном из 3-х свечей по 5 минут, стоит рассмотреть настраиваемый сдвиг окна rolling window на каждую следующую свечу - то есть не на 1 минуту, а сразу на 5 минут. При этом шаги должны быть привязаны к кратным минутам - 00:00, 05:00, 10:00, 15:00 и так далее.

## Анализ гипотезы о шаге 5 минут

### Текущая ситуация

1. Timestamp'ы генерируются с шагом 1 минута (`current += timedelta(minutes=1)`)
2. Все фичи в версии 1.7.0 имеют `lookback_window: 15m`
3. Свечные паттерны основаны на 3 свечах по 5 минут каждая
4. Группировка по 5-минутным интервалам работает так:
   - `16:40:00` → bucket `16:40:00`
   - `16:41:00` → bucket `16:40:00` (та же группа)
   - `16:42:00` → bucket `16:40:00` (та же группа)
   - `16:43:00` → bucket `16:40:00` (та же группа)
   - `16:44:00` → bucket `16:40:00` (та же группа)
   - `16:45:00` → bucket `16:45:00` (следующая группа)

### Проблема

Вычисление паттернов каждую минуту избыточно:
- Паттерны основаны на 5-минутных свечах
- Для всех timestamp'ов внутри одного 5-минутного интервала (16:40–16:44) паттерны одинаковы
- Это лишние вычисления и дублирование данных

### Предложение

Использовать шаг 5 минут для генерации timestamp'ов:
- Уменьшает количество строк в датасете: с 8640 (1440 минут) до 288 (144 интервала) в день
- Соответствует природе свечных паттернов (5-минутные интервалы)
- Сохраняет достаточную частоту для таргетов (horizon 900 секунд = 15 минут)

### Проверка совместимости

1. Таргеты: вычисляются как `(future_price - current_price) / current_price` с horizon 15 минут. Работают с любым шагом timestamp'ов, 5 минут подходит.
2. Фичи: все фичи имеют `lookback_window: 15m`, основаны на 5-минутных интервалах. 5-минутный шаг достаточен.
3. Другие компоненты: нужно проверить, нет ли зависимостей от поминутного шага.

### Рекомендация

Добавить параметр в Feature Registry YAML:
```yaml
version: 1.7.0
config:
  timestamp_interval_minutes: 5  # Шаг генерации timestamp'ов для датасета
features:
  ...
```

Или использовать максимальный lookback_window среди фич как шаг:
- Если все фичи имеют `lookback_window: 15m` (основаны на 5-минутных свечах), использовать шаг 5 минут
- Если есть фичи с меньшим lookback_window, использовать минимальный шаг

### Важно

Проверить:
1. Не требуют ли таргеты поминутного шага для точности
2. Совместимы ли другие части системы с 5-минутным шагом
3. Возможны ли потери информации при более редкой выборке

### Вывод

Гипотеза разумна. Для версии 1.7.0 (все фичи с `lookback_window: 15m`, основаны на 5-минутных свечах) шаг 5 минут достаточен и эффективнее. Лучше сделать это настраиваемым параметром в YAML, чтобы можно было менять шаг для разных версий регистра.
