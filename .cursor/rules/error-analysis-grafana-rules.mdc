---
alwaysApply: true
---

# Error Analysis: Grafana Container Issues

## Errors Encountered

### Error 1: Permission Denied on chmod
**Error**: `chmod: /entrypoint.sh: Operation not permitted`
**Cause**: Attempted to run `chmod` after switching to non-root user (`USER grafana`), but file was copied as root.
**Solution**: Move `chmod` operation BEFORE `USER` directive.

### Error 2: Permission Denied on File Write
**Error**: `mv: can't remove '/etc/grafana/provisioning/datasources/datasources.yml': Permission denied`
**Cause**: Entrypoint script running as `grafana` user tried to overwrite file in volume-mounted directory without write permissions.
**Solution**: Process files as root in entrypoint, or set directory permissions during build.

### Error 3: Unknown User in chown
**Error**: `chown: unknown user/group grafana:grafana`
**Cause**: Attempted to use username in `chown` when user doesn't exist yet in base image during build.
**Solution**: Use numeric UID/GID: `chown 472:472` instead of `chown grafana:grafana`.

### Error 4: Plugin Not Found
**Error**: `Error: âœ— 404: Plugin not found`
**Cause**: Incorrect plugin name `grafana-infinity-datasource` instead of `yesoreyeram-infinity-datasource`.
**Solution**: Verify plugin names from official Grafana plugin registry/documentation.

## Root Causes Summary

1. **User switching order**: Operations requiring root done after USER switch
2. **File permissions**: Volume-mounted files/directories not writable by container user
3. **User existence**: Referencing users that don't exist in base image
4. **Plugin naming**: Using incorrect/assumed plugin names without verification

## Prevention Rules

See `docker-best-practices.md` for comprehensive rules to prevent these errors.

