# –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ threshold –∏ horizon

–°–∫—Ä–∏–ø—Ç `analyze_threshold_horizon.py` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ—á–µ–π –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç** –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `MODEL_CLASSIFICATION_THRESHOLD` –∏ `MODEL_PREDICTION_HORIZON_SECONDS` –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ feature-service

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞** (—Å–∫—Ä–∏–ø—Ç —Å–∞–º –Ω–∞–π–¥–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã):

```bash
docker compose exec feature-service python3 /app/scripts/analyze_threshold_horizon.py \
  --start-date 2025-11-01 \
  --end-date 2025-12-10
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —à–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–æ–≤ (1-60 –º–∏–Ω—É—Ç) –∏ –ø–æ—Ä–æ–≥–æ–≤ (0.1-5%), —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `--horizons` –∏ `--thresholds` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ø–æ–∏—Å–∫–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏–∑.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `--symbol`: –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: BTCUSDT)
- `--start-date`: –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `--end-date`: –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `--horizons`: –ì–æ—Ä–∏–∑–æ–Ω—Ç—ã –≤ –º–∏–Ω—É—Ç–∞—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –æ—Ç 1 –¥–æ 60 –º–∏–Ω—É—Ç)
- `--thresholds`: –ü–æ—Ä–æ–≥–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –æ—Ç 0.1% –¥–æ 5%)
- `--target-percentage`: –¶–µ–ª–µ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –ø—Ä–æ—Ü–µ–Ω—Ç–∞ up/down –∫–ª–∞—Å—Å–æ–≤ (min,max) (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20,30)
- `--data-path`: –ü—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ FEATURE_SERVICE_RAW_DATA_PATH)

### –ü—Ä–∏–º–µ—Ä—ã

#### –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

```bash
docker compose exec feature-service python3 /app/scripts/analyze_threshold_horizon.py \
  --start-date 2025-11-10 \
  --end-date 2025-12-10
```

#### –ê–Ω–∞–ª–∏–∑ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –ø–æ–∏—Å–∫–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞):

```bash
docker compose exec feature-service python3 /app/scripts/analyze_threshold_horizon.py \
  --start-date 2025-11-01 \
  --end-date 2025-12-10 \
  --horizons 5,10,15,30 \
  --thresholds 0.3,0.5,1.0,2.0
```

#### –ê–Ω–∞–ª–∏–∑ —Å –¥—Ä—É–≥–∏–º —Ü–µ–ª–µ–≤—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º

```bash
docker compose exec feature-service python3 /app/scripts/analyze_threshold_horizon.py \
  --start-date 2025-11-01 \
  --end-date 2025-12-10 \
  --target-percentage 15,25
```

## –í—ã–≤–æ–¥

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç:

1. **–¢–∞–±–ª–∏—Ü—É**: –î–æ–ª—è —Å–≤–µ—á–µ–π —Å |ŒîP| > –ø–æ—Ä–æ–≥–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –≥–æ—Ä–∏–∑–æ–Ω—Ç—É
2. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ threshold –∏ horizon
3. **–õ—É—á—à—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é**: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
================================================================================
–ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–• –°–í–ï–ß–ï–ô –î–õ–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–ê–†–ê–ú–ï–¢–†–û–í –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–ò
================================================================================

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
  –°–∏–º–≤–æ–ª: BTCUSDT
  –ü–µ—Ä–∏–æ–¥: 2025-11-01 - 2025-12-10
  –ì–æ—Ä–∏–∑–æ–Ω—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫): 25 –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç 1 –¥–æ 60 –º–∏–Ω—É—Ç
  –ü–æ—Ä–æ–≥–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫): 13 –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç 0.1% –¥–æ 5.0%
  –¶–µ–ª–µ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω up/down: 20.0-30.0%

–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è BTCUSDT —Å 2025-11-01 –ø–æ 2025-12-10...
  –ó–∞–≥—Ä—É–∂–µ–Ω–æ 43200 —Å–≤–µ—á–µ–π

–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω—ã –∑–∞ —Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã...
–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ–ª–µ–π –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ø–æ—Ä–æ–≥–æ–≤...

================================================================================
–¢–ê–ë–õ–ò–¶–ê: –î–æ–ª—è —Å–≤–µ—á–µ–π —Å |ŒîP| > –ø–æ—Ä–æ–≥–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–º
================================================================================

–ì–æ—Ä–∏–∑–æ–Ω—Ç (–º–∏–Ω)    0.10%    0.20%    0.30%    0.50%    0.70%    1.00%    1.50%    2.00%    2.50%    3.00%    4.00%    5.00%
--------------------------------------------------------------------------------
1                 52.34%   45.23%   38.15%   28.15%   20.45%   12.45%    6.23%    3.21%    1.89%    0.98%    0.34%    0.12%
3                 58.67%   52.18%   45.67%   35.67%   28.92%   18.92%   11.54%    6.54%    4.23%    2.67%    1.12%    0.45%
5                 64.23%   58.34%   52.11%   42.11%   34.67%   24.67%   16.87%    9.87%    6.54%    4.23%    1.89%    0.78%
10                72.45%   65.12%   58.23%   50.23%   42.45%   32.45%   24.67%   15.67%   11.23%    7.89%    3.45%    1.56%
15                78.34%   70.45%   63.78%   56.78%   48.92%   38.92%   30.34%   20.34%   15.67%   11.23%    5.12%    2.34%
30                85.67%   78.23%   71.12%   65.12%   58.67%   48.67%   38.45%   28.45%   22.34%   17.67%    9.87%    4.56%
60                92.34%   85.67%   79.45%   75.34%   68.92%   62.34%   54.67%   42.12%   35.67%   29.45%   18.34%   10.23%
================================================================================

================================================================================
–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
================================================================================

üìä –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (–ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–º):
--------------------------------------------------------------------------------
  –ì–æ—Ä–∏–∑–æ–Ω—Ç: 15 –º–∏–Ω | –ü–æ—Ä–æ–≥: 0.500% | –î–æ–ª—è up/down: 25.34% (1234/4867 —Å–≤–µ—á–µ–π)

üéØ –õ–£–ß–®–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:
================================================================================
  MODEL_PREDICTION_HORIZON_SECONDS = 900
  MODEL_CLASSIFICATION_THRESHOLD = 0.0050

  –û–∂–∏–¥–∞–µ–º–∞—è –¥–æ–ª—è up/down –∫–ª–∞—Å—Å–æ–≤: 25.34%
  –û–∂–∏–¥–∞–µ–º–∞—è –¥–æ–ª—è flat –∫–ª–∞—Å—Å–∞: 74.66%
================================================================================
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- **–ì–æ—Ä–∏–∑–æ–Ω—Ç (horizon)**: –í—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
- **–ü–æ—Ä–æ–≥ (threshold)**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–∞–∫ "up" –∏–ª–∏ "down"
- **–î–æ–ª—è up/down**: –ü—Ä–æ—Ü–µ–Ω—Ç —Å–≤–µ—á–µ–π, –≥–¥–µ |ŒîP| > threshold

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–°–∫—Ä–∏–ø—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –≥–¥–µ –¥–æ–ª—è up/down –∫–ª–∞—Å—Å–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 20-30% (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ up/down
- –ù–µ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω—ã–π –¥–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ (flat –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >90%)
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç:

- **–ì–æ—Ä–∏–∑–æ–Ω—Ç—ã**: 1-5 –º–∏–Ω (—à–∞–≥ 1), 5-15 –º–∏–Ω (—à–∞–≥ 2), 15-30 –º–∏–Ω (—à–∞–≥ 5), 30-60 –º–∏–Ω (—à–∞–≥ 10) = **~25 –∑–Ω–∞—á–µ–Ω–∏–π**
- **–ü–æ—Ä–æ–≥–∏**: 0.1-0.3% (—à–∞–≥ 0.1), 0.5-1.0% (—à–∞–≥ 0.2-0.3), 1.5-3.0% (—à–∞–≥ 0.5), 4.0-5.0% (—à–∞–≥ 1.0) = **~13 –∑–Ω–∞—á–µ–Ω–∏–π**

–ò—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è **~325 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π** –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Parquet —Ñ–∞–π–ª–æ–≤, —Ö—Ä–∞–Ω—è—â–∏—Ö—Å—è –≤ `/data/raw/klines/`
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ backfilling –∏–ª–∏ WebSocket
- –§–æ—Ä–º—É–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã: ŒîP = (close_future - open_current) / open_current
- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
